# Netlify configuration for Espacio Ludimente

[build]
  # Build command - includes type checking
  command = "npm run build"

  # Output directory - Astro's default
  publish = "dist"

  # Node version for consistent builds
  node_version = "20"

# Redirect rules for proper routing
[[redirects]]
  # Handle 404 errors with custom page
  from = "/*"
  to = "/404.html"
  status = 404

# Security headers for all pages
[[headers]]
  for = "/*"
  [headers.values]
    # Prevent MIME type sniffing
    X-Content-Type-Options = "nosniff"

    # Prevent clickjacking
    X-Frame-Options = "SAMEORIGIN"

    # XSS protection
    X-XSS-Protection = "1; mode=block"

    # Control referrer information
    Referrer-Policy = "strict-origin-when-cross-origin"

    # Permissions policy
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

# Cache headers for hashed assets (Astro's _astro folder)
[[headers]]
  for = "/_astro/*"
  [headers.values]
    # Long cache for versioned assets (they have unique hashes)
    Cache-Control = "public, max-age=31536000, immutable"

# Cache headers for images in public folder
[[headers]]
  for = "/images/*"
  [headers.values]
    # Cache images for 1 year
    Cache-Control = "public, max-age=31536000, immutable"

# Cache headers for favicon
[[headers]]
  for = "/favicon.svg"
  [headers.values]
    # Cache favicon for 1 day
    Cache-Control = "public, max-age=86400"

# No cache for HTML pages (for fresh content)
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"
