---
/**
 * [slug].astro
 * P√°gina din√°mica para art√≠culos individuales de blog
 * Genera rutas como /blog/que-es-la-tcc, /blog/manejo-berrinches, etc.
 */

import MainLayout from '../../layouts/MainLayout.astro';
import Button from '../../components/Button.astro';
import CTASection from '../../components/CTASection.astro';
import SchemaOrg from '../../components/SchemaOrg.astro';
import { posts } from '../../data/blog-posts';
import { contactInfo } from '../../data/contact-info';
import { getBlogPostingSchema } from '../../data/schema-helpers';

// Genera las rutas est√°ticas para cada post
export async function getStaticPaths() {
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post }
  }));
}

const { post } = Astro.props;

// Formatear fecha en espa√±ol
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('es-MX', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};

// Schema para el art√≠culo de blog
const blogSchema = getBlogPostingSchema(post);
---

<MainLayout
  title={`${post.title} - Blog de Espacio Ludimente`}
  description={post.excerpt}
  ogImage={post.image}
>
  <!-- Schema.org para blog post -->
  <SchemaOrg schema={blogSchema} slot="head" />
  <!-- Art√≠culo principal -->
  <article class="blog-post">
    <div class="container content-narrow">

      <!-- Header del art√≠culo -->
      <header class="post-header">
        <a href="/blog" class="back-link">
          ‚Üê Volver al blog
        </a>

        <h1 class="post-title">{post.title}</h1>

        <div class="post-meta">
          <time datetime={post.date} class="post-date">
            {formatDate(post.date)}
          </time>
          <span class="reading-time">‚Ä¢ 5 min de lectura</span>
        </div>
      </header>

      <!-- Imagen destacada -->
      {post.image && (
        <div class="featured-image">
          <img
            src={post.image}
            alt={post.imageAlt || `Imagen del art√≠culo: ${post.title}`}
            loading="eager"
          />
        </div>
      )}

      <!-- Contenido del art√≠culo -->
      <div class="post-content">
        <div class="intro">
          <p class="excerpt">{post.excerpt}</p>
        </div>

        <!-- TODO: Aqu√≠ ir√° el contenido completo del art√≠culo -->
        <!-- Por ahora mostramos un placeholder con estructura t√≠pica -->

        <section class="content-section">
          <h2>Introducci√≥n</h2>
          <p>
            Este art√≠culo profundiza en el tema de <strong>{post.title.toLowerCase()}</strong>,
            proporcionando informaci√≥n pr√°ctica y basada en evidencia para familias y profesionales.
          </p>
          <p>
            En Espacio Ludimente, creemos en compartir conocimiento accesible que ayude
            a las familias a comprender mejor el desarrollo emocional y cognitivo de sus hijos.
          </p>
        </section>

        <section class="content-section">
          <h2>Puntos Clave</h2>
          <ul>
            <li>La importancia de la detecci√≥n temprana</li>
            <li>Estrategias pr√°cticas para implementar en casa</li>
            <li>Cu√°ndo buscar ayuda profesional</li>
            <li>Herramientas basadas en evidencia cient√≠fica</li>
          </ul>
        </section>

        <section class="content-section">
          <h2>Conclusi√≥n</h2>
          <p>
            Recuerda que cada ni√±o es √∫nico y lo que funciona para uno puede necesitar
            ajustes para otro. Si necesitas orientaci√≥n personalizada, nuestro equipo
            est√° aqu√≠ para acompa√±arte.
          </p>
        </section>

        <!-- Nota informativa -->
        <div class="info-box">
          <p>
            <strong>üí° Nota:</strong> Este art√≠culo tiene fines informativos y no sustituye
            la consulta con un profesional de la salud mental. Si tienes dudas sobre el
            desarrollo de tu hijo, te recomendamos agendar una valoraci√≥n.
          </p>
        </div>
      </div>

      <!-- Navegaci√≥n entre art√≠culos -->
      <nav class="post-navigation" aria-label="Art√≠culos relacionados">
        <h3>M√°s art√≠culos del blog</h3>
        <div class="related-posts">
          <a href="/blog" class="nav-link">
            Ver todos los art√≠culos ‚Üí
          </a>
        </div>
      </nav>

    </div>
  </article>

  <!-- CTA al final -->
  <CTASection
    title="¬øTe identificas con este tema?"
    description="Agenda una sesi√≥n de valoraci√≥n y descubre c√≥mo podemos ayudarte a ti y a tu familia."
    primaryCTA={{ text: "Reservar sesi√≥n", href: "/reservar", variant: "primary" }}
    secondaryCTA={{ text: "Contactar por WhatsApp", href: contactInfo.social.find(s => s.platform === 'whatsapp')?.url || "#", variant: "outline" }}
  />
</MainLayout>

<style>
  /* ================================
     BLOG POST - Layout
     ================================ */

  .blog-post {
    padding: var(--spacing-xl) 0;
    background-color: var(--color-background);
  }

  /* ================================
     HEADER DEL ART√çCULO
     ================================ */

  .post-header {
    margin-bottom: var(--spacing-xl);
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--color-primary);
    text-decoration: none;
    font-family: var(--font-body);
    font-size: var(--text-body);
    font-weight: 500;
    margin-bottom: var(--spacing-md);
    transition: transform var(--transition-fast);
  }

  .back-link:hover {
    transform: translateX(-4px);
  }

  .post-title {
    font-family: var(--font-display);
    font-size: var(--text-display-large);
    font-weight: 700;
    color: var(--color-text);
    line-height: 1.2;
    margin-bottom: var(--spacing-sm);
  }

  .post-meta {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-family: var(--font-body);
    font-size: var(--text-body-small);
    color: var(--color-text);
    opacity: 0.7;
  }

  .post-date {
    font-weight: 500;
  }

  .reading-time {
    color: var(--color-text);
  }

  /* ================================
     IMAGEN DESTACADA
     ================================ */

  .featured-image {
    width: 100%;
    margin-bottom: var(--spacing-xl);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-md);
  }

  .featured-image img {
    width: 100%;
    height: auto;
    display: block;
    aspect-ratio: 16 / 9;
    object-fit: cover;
  }

  /* ================================
     CONTENIDO DEL ART√çCULO
     ================================ */

  .post-content {
    font-family: var(--font-body);
    font-size: var(--text-body-large);
    line-height: 1.8;
    color: var(--color-text);
  }

  .intro {
    margin-bottom: var(--spacing-lg);
  }

  .excerpt {
    font-size: 1.25rem;
    line-height: 1.6;
    color: var(--color-text);
    opacity: 0.85;
    font-style: italic;
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-md);
    border-left: 4px solid var(--color-primary);
  }

  .content-section {
    margin-bottom: var(--spacing-lg);
  }

  .content-section h2 {
    font-family: var(--font-display);
    font-size: var(--text-headline-large);
    font-weight: 700;
    color: var(--color-text);
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-md);
  }

  .content-section h3 {
    font-family: var(--font-display);
    font-size: var(--text-headline-medium);
    font-weight: 600;
    color: var(--color-text);
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-sm);
  }

  .content-section p {
    margin-bottom: var(--spacing-md);
  }

  .content-section ul,
  .content-section ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-lg);
  }

  .content-section li {
    margin-bottom: var(--spacing-xs);
  }

  .content-section strong {
    color: var(--color-text);
    font-weight: 600;
  }

  /* Info box */
  .info-box {
    background-color: var(--color-surface);
    border-left: 4px solid var(--color-accent);
    padding: var(--spacing-md);
    border-radius: var(--radius-sm);
    margin: var(--spacing-lg) 0;
  }

  .info-box p {
    margin: 0;
    font-size: var(--text-body);
    line-height: 1.6;
  }

  /* ================================
     NAVEGACI√ìN ENTRE POSTS
     ================================ */

  .post-navigation {
    margin-top: var(--spacing-xl);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-outline);
  }

  .post-navigation h3 {
    font-family: var(--font-display);
    font-size: var(--text-headline-medium);
    font-weight: 700;
    color: var(--color-text);
    margin-bottom: var(--spacing-md);
  }

  .related-posts {
    display: flex;
    gap: var(--spacing-md);
  }

  .nav-link {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500;
    font-size: var(--text-body-large);
    transition: transform var(--transition-fast);
    display: inline-block;
  }

  .nav-link:hover {
    transform: translateX(4px);
  }

  /* ================================
     RESPONSIVE
     ================================ */

  @media (max-width: 768px) {
    .post-title {
      font-size: 2rem;
    }

    .post-content {
      font-size: var(--text-body);
    }

    .excerpt {
      font-size: 1.125rem;
      padding-left: var(--spacing-sm);
    }

    .content-section h2 {
      font-size: 1.75rem;
    }
  }
</style>
